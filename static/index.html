<script>
  // Brug relativ sti i stedet for localhost
  const url = "/send";

  function sendOpgave() {
    const navn       = document.getElementById("opgaveNavn").value;
    const medarbejder= document.getElementById("medarbejderNavn").value;

    fetch(url, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        from_agent: "OpgaveAgent",
        to_agent:   "OpgaveAgent",
        content: {
          opgave_navn: navn,
          medarbejder,
          status:      "aktiv"
        }
      })
    }).then(() => alert("‚úÖ Opgave sendt!"));
  }

  function sendTimer() {
    const navn   = document.getElementById("tidMedarbejder").value;
    const opgave = document.getElementById("opgaveTidNavn").value;
    const timer  = parseFloat(document.getElementById("antalTimer").value);

    fetch(url, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        from_agent: "TidsAgent",
        to_agent:   "TidsAgent",
        content: {
          medarbejder: navn,
          opgave,
          timer
        }
      })
    }).then(() => alert("‚úÖ Timer sendt!"));
  }

  function sendL√∏n() {
    const navn  = document.getElementById("l√∏nMedarbejder").value;
    const timer = parseFloat(document.getElementById("l√∏nTimer").value);

    fetch(url, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        from_agent: "TidsAgent",
        to_agent:   "L√∏nAgent",
        content: {
          medarbejder: navn,
          timer
        }
      })
    })
    .then(res => res.json())
    .then(data => alert(`üí∞ Beregnet l√∏n: ${data.l√∏nbel√∏b} DKK`));
  }

  function hentOpgaver() {
    const navn = document.getElementById("seNavn").value;
    fetch(`/opgaver/${encodeURIComponent(navn)}`)
      .then(res => res.json())
      .then(data => {
        const liste = document.getElementById("opgaveListe");
        liste.innerHTML = "";
        if (data.length === 0) {
          liste.innerHTML = "<li>Ingen opgaver fundet</li>";
        } else {
          data.forEach(opgave => {
            const li = document.createElement("li");
            li.textContent = `${opgave.opgave_navn} (${opgave.status})`;
            if (opgave.status !== "f√¶rdig") {
              const btn = document.createElement("button");
              btn.textContent = "Afslut";
              btn.style.marginLeft = "10px";
              btn.onclick = () => afslutOpgave(navn, opgave.opgave_navn);
              li.appendChild(btn);
            }
            liste.appendChild(li);
          });
        }
      })
      .catch(err => console.error("Kunne ikke hente opgaver:", err));
  }

  function afslutOpgave(medarbejder, opgavenavn) {
    fetch("/opgaver/afslut", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ medarbejder, opgave_navn: opgavenavn })
    })
    .then(() => {
      alert("‚úÖ Opgave markeret som f√¶rdig!");
      hentOpgaver();
    });
  }

  function visTimer() {
    const navn = document.getElementById("timerNavn").value;
    fetch(`/timer/${encodeURIComponent(navn)}`)
      .then(res => res.json())
      .then(data => {
        const liste = document.getElementById("timerListe");
        liste.innerHTML = "";
        data.forEach(row => {
          const li = document.createElement("li");
          li.textContent = `${row.opgave}: ${row.timer} timer`;
          liste.appendChild(li);
        });
      })
      .catch(err => console.error("Kunne ikke hente timer:", err));
  }

  function visL√∏n() {
    const navn = document.getElementById("lonNavn").value;
    fetch(`/l√∏n/${encodeURIComponent(navn)}`)
      .then(res => res.json())
      .then(data => {
        document.getElementById("lonSvar").textContent =
          `üí∞ Samlet l√∏n: ${data.samlet_l√∏n} DKK`;
      })
      .catch(err => console.error("Kunne ikke hente l√∏n:", err));
  }

  function visAktive() {
    const navn = document.getElementById("aktivNavn").value;
    fetch(`/opgaver/${encodeURIComponent(navn)}/status/aktiv`)
      .then(res => res.json())
      .then(data => {
        const liste = document.getElementById("aktiveListe");
        liste.innerHTML = "";
        data.forEach(opgave => {
          const li = document.createElement("li");
          li.textContent = opgave.opgave_navn;
          liste.appendChild(li);
        });
      })
      .catch(err => console.error("Kunne ikke hente aktive opgaver:", err));
  }

  function visFaerdige() {
    const navn = document.getElementById("faerdigNavn").value;
    fetch(`/opgaver/${encodeURIComponent(navn)}/status/f√¶rdig`)
      .then(res => res.json())
      .then(data => {
        const liste = document.getElementById("faerdigeListe");
        liste.innerHTML = "";
        data.forEach(opgave => {
          const li = document.createElement("li");
          li.textContent = opgave.opgave_navn;
          liste.appendChild(li);
        });
      })
      .catch(err => console.error("Kunne ikke hente f√¶rdige opgaver:", err));
  }
</script>
